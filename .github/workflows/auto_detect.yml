name: PokÃ©mon League Auto Detector

on:
  # æ¯å¤©è‡ªå‹•åŸ·è¡Œï¼šè¨­å®šç‚º UTC 02:00 (å°ç£æ™‚é–“æ—©ä¸Š 10 é»)
  schedule:
    - cron: '0 2 * * *'
  # å…è¨±åœ¨ GitHub ç¶²é ä¸Šæ‰‹å‹•é»æ“ŠåŸ·è¡Œ
  workflow_dispatch:

jobs:
  detect:
    runs-on: ubuntu-latest
    
    # é—œéµï¼šæˆäºˆ Action æŠŠç”Ÿæˆçš„ JSON æ¨é€å› Repo çš„æ¬Šé™
    permissions:
      contents: write

    steps:
      # 1. æª¢å‡ºç¨‹å¼ç¢¼
      - name: Checkout Code
        uses: actions/checkout@v4

      # 2. å®‰è£ Python ç’°å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. å®‰è£å¿…è¦å¥—ä»¶
      - name: Install Dependencies
        run: pip install requests beautifulsoup4

      # 4. åŸ·è¡Œçˆ¬èŸ²è…³æœ¬ (æª”åå·²æ›´æ–°)
      - name: Run Scraper
        run: python pk_grab_from_official.py

      # 5. æäº¤ç”Ÿæˆçš„ manifest.json ä¸¦æ¨é€
      - name: Commit and Push manifest.json
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          if [ -n "$(git status --porcelain data/manifest.json)" ]; then
            git add data/manifest.json
            
            # ğŸ‘‡ ä¿®æ”¹é€™ä¸€è¡Œï¼šåŠ ä¸Š TZ='Asia/Taipei'
            git commit -m "ğŸ¤– è‡ªå‹•æ›´æ–°å¯¦æ™‚è¯ç›Ÿç´¢å¼•: $(TZ='Asia/Taipei' date +'%Y-%m-%d %H:%M')"
            
            git push
            echo "âœ… è³‡æ–™å·²æ›´æ–°ä¸¦æ¨é€åˆ° Repo"
          else
            echo "â„¹ï¸ è³‡æ–™ç„¡è®Šå‹•ï¼Œè·³éæäº¤"
          fi
